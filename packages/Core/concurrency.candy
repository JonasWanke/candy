builtins = use "Builtins"
channel = use "..channel"
function = use "..function"
[if] = use "..controlFlow"

parallel := builtins.parallel

async nursery body :=
  needs (channel.isSendPort nursery)
  needs (function.is0 body)
  returnChannel = channel.create 1
  nursery | channel.send [Function: body, ReturnChannel: returnChannel.sendPort]
  returnChannel.receivePort

await fiber :=
  needs (channel.isReceivePort fiber) "`fiber` should be a value returned by `async`."
  fiber | channel.receive
